<script>
  document.addEventListener("DOMContentLoaded", function() {
    const tocContainer = document.getElementById("table-of-contents");
    const postContent = document.querySelector(".post-content");

    console.log("TOC Container:", tocContainer);
    console.log("Post Content:", postContent);

    if (tocContainer && postContent) {
      const headers = postContent.querySelectorAll("h1, h2, h3, h4, h5, h6");

      console.log("Headers found:", headers.length);

      if (headers.length > 0) {
        let tocList = document.createElement("ul");
        let lastLevel = 1;
        let lastList = tocList;

        headers.forEach((header, index) => {
          header.id = "toc-" + index;
          const level = parseInt(header.tagName.charAt(1));

          console.log(`Processing header: ${header.textContent} (Level ${level})`);

          let tocItem = document.createElement("li");
          let tocLink = document.createElement("a");
          tocLink.href = "#" + header.id;
          tocLink.textContent = header.textContent;
          tocItem.appendChild(tocLink);

          if (level > lastLevel) {
            const newList = document.createElement("ul");
            if (lastList.lastChild) {
              lastList.lastChild.appendChild(newList);
              lastList = newList;
            } else {
              console.error("Last list item does not exist to append the new list");
            }
          } else if (level < lastLevel) {
            lastList = tocList;
            for (let i = 1; i < level; i++) {
              if (lastList.lastChild && lastList.lastChild.lastChild) {
                lastList = lastList.lastChild.lastChild;
              }
            }
          }

          lastList.appendChild(tocItem);
          lastLevel = level;
        });

        tocContainer.appendChild(tocList);
      } else {
        tocContainer.style.display = "none"; // Hide ToC if no headers found
      }
    } else {
      console.error("TOC Container or Post Content not found");
    }
  });
</script>
